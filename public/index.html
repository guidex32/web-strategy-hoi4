<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HOI-Lite — стратегия</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">HOI-Lite (Node)</div>
    <nav class="nav">
      <button id="btn-login" class="btn">Войти</button>
      <button id="btn-logout" class="btn btn-ghost hidden">Выйти</button>
      <span id="user-info" class="badge hidden"></span>
      <span id="points" class="badge">Очки: 0</span>
    </nav>
  </header>

  <main class="layout">
    <aside class="panel">
      <h3>Действия</h3>
      <div id="actions" class="actions">
        <button class="btn" data-action="economy-spend" data-cost="5">(Г) Построить здание (+экономика)</button>
        <button class="btn" data-action="buy-unit" data-unit="tank" data-cost="10">(Г) Купить танк</button>
        <button class="btn" data-action="buy-unit" data-unit="pvo" data-cost="12">(Г) Купить ПВО</button>
        <button class="btn" data-action="declare-war">(Г) Объявить войну</button>
        <button class="btn" data-action="attack">(Г) Атака</button>
        <hr/>
        <button class="btn btn-warn" data-action="admin-open">(А) Панель админа</button>
      </div>

      <div id="admin-panel" class="admin hidden">
        <h3>Админка (А)</h3>
        <div class="stack">
          <button class="btn" data-admin="create-country">Создать страну</button>
          <button class="btn" data-admin="assign-owner">Назначить владельца</button>
          <button class="btn" data-admin="give-points">Выдать очки</button>
          <button class="btn" data-admin="toggle-economy">Экономика: вкл/выкл</button>
          <button class="btn" data-admin="view-logs">Логи</button>
        </div>
      </div>
    </aside>

    <section class="map-wrap">
      <object id="map" type="image/svg+xml" data="img/map.svg"></object>
      <div id="tooltip" class="tooltip hidden"></div>
    </section>

    <aside class="panel">
      <h3>Инфо</h3>
      <div id="info" class="info">
        <div><b>Страна:</b> <span id="info-country">—</span></div>
        <div><b>Владелец:</b> <span id="info-owner">—</span></div>
        <div><b>Экономика:</b> <span id="info-econ">0</span></div>
        <div><b>Армия:</b> <span id="info-army">нет</span></div>
        <div><b>Статус:</b> <span id="info-status">мир</span></div>
      </div>
    </aside>
  </main>

  <dialog id="dlg-auth">
    <form method="dialog" class="stack">
      <h3>Вход / Регистрация</h3>
      <input type="text" id="auth-username" placeholder="Логин" required />
      <input type="password" id="auth-password" placeholder="Пароль" required />
      <div class="row">
        <button type="button" id="btn-register" class="btn">Регистрация</button>
        <button type="button" id="btn-signin" class="btn btn-primary">Войти</button>
        <button class="btn btn-ghost" value="cancel">Закрыть</button>
      </div>
      <small>Роли: admin / owner / player. Админа можно назначить вручную</small>
    </form>
  </dialog>

  <dialog id="dlg-prompt">
    <form method="dialog" class="stack">
      <h3 id="prompt-title">Заголовок</h3>
      <input type="text" id="prompt-input" placeholder="значение"/>
      <div class="row">
        <button id="prompt-ok" class="btn btn-primary">Ок</button>
        <button class="btn btn-ghost" value="cancel">Отмена</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlg-logs">
    <form method="dialog" class="stack">
      <h3>Логи</h3>
      <pre id="logs-view" class="logs"></pre>
      <div class="row"><button class="btn btn-primary">Закрыть</button></div>
    </form>
  </dialog>

  <script>
    // защита от null и подключение кнопок
    const btnLogin = document.getElementById('btn-login');
    const btnLogout = document.getElementById('btn-logout');
    const userInfo = document.getElementById('user-info');
    const dlgAuth = document.getElementById('dlg-auth');

    if (btnLogin && btnLogout && userInfo && dlgAuth) {
      btnLogin.onclick = () => dlgAuth.showModal();
      btnLogout.onclick = () => {
        localStorage.removeItem('token');
        userInfo.classList.add('hidden');
        userInfo.textContent = '';
        btnLogout.classList.add('hidden');
        btnLogin.classList.remove('hidden');
      };
    }
  </script>

  <script src="js/app.js"></script>
</body>
</html>
